import{f as D,r as s,E as l,b as E,j as e,L}from"./index-Q6dyHrre.js";import{S as U,c as a,b as h,B as O}from"./index-zoz3kVfw.js";import{a as n,g as H}from"./index-Bkeb3vF4.js";import{l as A}from"./index-CF4wHI2V.js";const V=()=>{const{getUserCookie:p}=D(),[B,j]=s.useState([]),[M,f]=s.useState([]),[o,_]=s.useState(""),[$,F]=s.useState(!1),[u,P]=s.useState("All Tickets"),{call:y}=l("internal_ticketing.ticketing_api.get_ticket_count_by_department"),{call:b}=l("internal_ticketing.ticketing_api.get_ticket_list"),[Q,I]=s.useState("All Tickets"),[d,k]=s.useState(""),[g,v]=s.useState(""),[W,R]=s.useState([]),{ticketId:q}=E();n.set(p);const[m,N]=s.useState([]),x=A("http://10.80.4.63:9001"),{call:w}=l("internal_ticketing.ticketing_api.get_user_department");x.on("ticket_updated",t=>{console.log("ðŸ”„ Ticket update received from Node:",t)}),x.on("new_ticket",t=>{console.log("ðŸ”„ New ticket received from Node:",t)}),s.useEffect(()=>{w({user_id:n.get("user_id")}).then(t=>{k(t.message[0].department),v(t.message[0].user_permission_type),T(d,g,n.get("user_id")),S(d,g,n.get("user_id"))}).catch(t=>{console.log("Error",t)})},[d]);const T=(t,c,i)=>{y({department:t,user_permission_type:c,user_id:i}).then(r=>{j(Object.values(r.message))}).catch(r=>{console.log("Error",r)})},S=(t,c,i)=>{b({department:t,user_permission_type:c,user_id:i}).then(r=>{f(r.message)}).catch(r=>{console.log("Error",r)})},{call:C}=l("internal_ticketing.ticketing_api.get_ticket_history");return s.useEffect(()=>{C({user_id:n.get("user_id")}).then(t=>{N(t)})},[]),e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"w-full flex",children:e.jsx("div",{className:"w-1/2",children:e.jsx(U,{searchQuery:o,onSearchQueryChange:_})})}),e.jsxs("div",{className:"p-4 shadow-2xl rounded-lg bg-white mt-3",children:[e.jsx("div",{className:"flex justify-between items-center px-4 my-2",children:e.jsx("h2",{className:"text-xl font-bold",children:(m.message,"Ticket History")})}),e.jsx("hr",{className:"border-gray-200 mt-4"}),e.jsx("div",{className:"p-2 rounded-lg bg-white cursor-pointer overflow-y-auto max-h-[600px] scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-100 flex flex-col gap-1 mt-2",children:m.message?m.message.map(t=>(u==="All Tickets"||t.ticket_status===u)&&(o===""||t.subject.toLowerCase().includes(o.toLowerCase()))&&e.jsxs(L,{to:`/dashboard/tickets/${t.name}`,className:"border-2 border-gray-200 p-4 mb-2 rounded hover:bg-[rgb(177,216,216)] flex justify-between items-start rounded-2xl",children:[e.jsxs("div",{className:"flex ",children:[t.status==="Open"&&e.jsx("div",{className:"bg-red-100  flex items-center justify-center rounded-md w-7 h-7 mr-4 mt-1",children:e.jsx(a,{color:"red"})}),t.status==="Working"&&e.jsx("div",{className:"bg-green-100  flex items-center justify-center rounded-md w-7 h-7 mr-4 mt-1",children:e.jsx(h,{color:"green"})}),t.status==="Solved"&&e.jsx("div",{className:"bg-green-100  flex items-center justify-center rounded-md w-7 h-7 mr-4 mt-1",children:e.jsx(h,{color:"green"})}),t.status==="Sent"&&e.jsx("div",{className:"bg-green-100  flex items-center justify-center rounded-md w-7 h-7 mr-4 mt-1",children:e.jsx(a,{color:"green"})}),t.status==="Unassigned"&&e.jsx("div",{className:"bg-green-100  flex items-center justify-center rounded-md w-7 h-7 mr-4 mt-1",children:e.jsx(a,{color:"green"})}),t.status==="Overdue"&&e.jsx("div",{className:"bg-red-100  flex items-center justify-center rounded-md w-7 h-7 mr-4 mt-1",children:e.jsx(a,{color:"red"})}),t.status==="Closed"&&e.jsx("div",{className:"bg-red-100  flex items-center justify-center rounded-md w-7 h-7 mr-4 mt-1",children:e.jsx(a,{color:"red"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[t.priority==="High"&&e.jsx("div",{className:"bg-red-100 p-1.5 rounded-full w-7 h-7",children:e.jsx(a,{color:"red"})}),t.priority==="Medium"&&e.jsx("div",{className:"bg-yellow-100 p-1.5 rounded-full w-7 h-7",children:e.jsx(a,{color:"yellow"})}),t.priority==="Low"&&e.jsx("div",{className:"bg-green-100 p-1.5 rounded-full w-7 h-7",children:e.jsx(a,{color:"green"})}),e.jsx("h3",{className:"font-bold",children:t.subject})]}),e.jsxs("div",{className:"flex flex-col ml-8",children:[e.jsx("p",{children:t.assigned_to}),e.jsxs("p",{className:"text-center w-fit text-sm flex items-center gap-1 mt-2",children:[e.jsx(O,{}),(()=>{const i=new Date(t.creation).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),r=t.creation.split(" ")[1].split(".")[0];return`${i} ${r}`})()]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end",children:[e.jsx("p",{className:`rounded-2xl text-center py-1 px-4 w-fit text-sm ${t.ticket_status==="Open"?"bg-red-100 text-red-600":t.ticket_status==="Working Tickets"||t.ticket_status==="Solved Tickets "?"bg-green-100 text-green-600":t.ticket_status==="Sent Tickets"?"bg-purple-100 text-purple-600":t.ticket_status==="Unassigned Tickets"?"bg-orange-100 text-orange-600":t.ticket_status==="Overdue Tickets"?"bg-red-100 text-red-600":t.ticket_status==="Closed Tickets"?"bg-gray-100 text-gray-600":"bg-pink-100 text-pink-600"}`,children:t.ticket_status.split("Tickets")[0]}),e.jsxs("div",{className:"text-center w-fit text-sm flex items-center gap-1",children:[e.jsx(H,{}),e.jsxs("p",{className:"text-sm",children:["Due: ",new Date(t.due_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})," "]})]})]})]},t.name)):e.jsx("p",{className:"text-gray-500",children:"No tickets found"})})]})]})};export{V as default};
